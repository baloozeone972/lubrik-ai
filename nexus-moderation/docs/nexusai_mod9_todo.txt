# Module 9 - Moderation System : Ce qui reste Ã  faire

## âœ… Ce qui est FAIT (70% du module)

### Core Infrastructure
- âœ… Architecture complÃ¨te documentÃ©e
- âœ… Structure Maven du projet
- âœ… Configuration Spring Boot (application.yml)
- âœ… Configuration Docker & Kubernetes
- âœ… Migrations Flyway (tables + rÃ¨gles par dÃ©faut)

### Services Core
- âœ… **TextModerationService** (100%)
  - ModÃ©ration texte avec OpenAI
  - Gestion multi-niveaux (STRICT/LIGHT/OPTIONAL)
  - DÃ©tection contenu illÃ©gal (CSAM, terrorisme)
  - CrÃ©ation d'incidents
- âœ… **DistressDetectionService** (100%)
  - DÃ©tection patterns suicidaires
  - Intervention automatique
  - Envoi ressources d'aide
- âœ… **BlacklistService** (100%)
  - Chargement blacklist
  - VÃ©rification termes interdits
  - Support regex
- âœ… **ModerationRulesService** (100%)
  - RÃ©cupÃ©ration rÃ¨gles par niveau
  - Cache Redis

### Clients & Repositories
- âœ… **OpenAIModerationClient** (100%)
- âœ… **UserServiceClient** (Feign) (100%)
- âœ… **ModerationIncidentRepository** (100%)
- âœ… **ModerationRuleRepository** (100%)

### Controllers
- âœ… **ModerationController** (80%)
  - POST /api/v1/moderation/text âœ…
  - POST /api/v1/moderation/image â³ (endpoint crÃ©Ã©, implÃ©mentation manquante)
  - POST /api/v1/moderation/video â³ (endpoint crÃ©Ã©, implÃ©mentation manquante)

### Tests
- âœ… **TextModerationServiceTest** (8 tests, coverage 85%)
- âœ… **DistressDetectionServiceTest** (4 tests, coverage 90%)
- âœ… **ModerationIncidentRepositoryTest** (3 tests)
- âœ… **ModerationIntegrationTest** (1 test E2E avec Testcontainers)

### Documentation
- âœ… README complet
- âœ… Quick Start Guide
- âœ… Architecture dÃ©taillÃ©e
- âœ… API documentation (Swagger)

---

## ğŸ”´ Ce qui reste Ã  faire (30% du module)

### 1. Services Media Moderation (DÃ©veloppeur 2) - 2 semaines

#### ImageModerationService
```java
âŒ MÃ©thode moderateImage()
âŒ IntÃ©gration AWS Rekognition
âŒ IntÃ©gration PhotoDNA (CSAM detection)
âŒ Analyse labels/modÃ©ration
âŒ DÃ©tection nuditÃ© explicite
âŒ Gestion erreurs API
âŒ Tests unitaires (coverage 80%+)
```

#### VideoModerationService
```java
âŒ MÃ©thode moderateVideo()
âŒ Extraction de frames (FFmpeg)
âŒ Analyse frame par frame
âŒ Analyse piste audio
âŒ Score global de modÃ©ration
âŒ Gestion vidÃ©os longues (async)
âŒ Tests unitaires (coverage 80%+)
```

#### RekognitionClient
```java
âŒ Configuration AWS SDK
âŒ MÃ©thode detectModerationLabels()
âŒ MÃ©thode detectExplicitContent()
âŒ Gestion throttling AWS
âŒ Fallback en cas d'erreur
```

#### PhotoDNAClient
```java
âŒ Configuration Microsoft PhotoDNA
âŒ MÃ©thode checkCSAM()
âŒ Gestion rÃ©ponse API
âŒ Logging sÃ©curisÃ© (pas de contenu dans logs)
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/service/moderation/
â”œâ”€â”€ ImageModerationService.java
â”œâ”€â”€ VideoModerationService.java

src/main/java/com/nexusai/moderation/service/client/
â”œâ”€â”€ RekognitionClient.java
â”œâ”€â”€ PhotoDNAClient.java

src/test/java/com/nexusai/moderation/service/moderation/
â”œâ”€â”€ ImageModerationServiceTest.java
â””â”€â”€ VideoModerationServiceTest.java
```

---

### 2. Detection Services (DÃ©veloppeur 3) - 1 semaine

#### EmotionAnalysisService
```java
âŒ MÃ©thode analyzeEmotion(String text)
âŒ DÃ©tection Ã©motions (joie, tristesse, colÃ¨re, peur)
âŒ Score intensitÃ© Ã©motionnelle
âŒ Tracking Ã©tat Ã©motionnel sur conversation
âŒ Tests unitaires
```

#### ContentClassificationService
```java
âŒ MÃ©thode classifyContent(String content)
âŒ Classification catÃ©gories (news, opinion, fiction, etc.)
âŒ DÃ©tection spam/phishing
âŒ DÃ©tection manipulation/deepfake mentions
âŒ Tests unitaires
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/service/detection/
â”œâ”€â”€ EmotionAnalysisService.java
â””â”€â”€ ContentClassificationService.java

src/test/java/com/nexusai/moderation/service/detection/
â”œâ”€â”€ EmotionAnalysisServiceTest.java
â””â”€â”€ ContentClassificationServiceTest.java
```

---

### 3. Incident Management (DÃ©veloppeur 4) - 2 semaines

#### IncidentManagementService
```java
âŒ MÃ©thode createIncident()
âŒ MÃ©thode updateIncidentStatus()
âŒ MÃ©thode escalateIncident() (CRITICAL â†’ ModÃ©rateurs)
âŒ MÃ©thode getIncidentsByUser()
âŒ MÃ©thode getIncidentStatistics()
âŒ Workflow review (PENDING â†’ IN_REVIEW â†’ RESOLVED)
âŒ Tests unitaires
```

#### WarningService
```java
âŒ MÃ©thode issueWarning(userId, incidentId, type)
âŒ MÃ©thode getUserWarnings(userId)
âŒ MÃ©thode acknowledgeWarning(warningId)
âŒ SystÃ¨me de points (3 warnings = ban temporaire)
âŒ Expiration warnings (30 jours)
âŒ Tests unitaires
```

#### EscalationService
```java
âŒ MÃ©thode shouldEscalate(incident)
âŒ MÃ©thode escalateToModerators(incidentId)
âŒ MÃ©thode escalateToLegal(incidentId) (CSAM/terrorisme)
âŒ Notification modÃ©rateurs
âŒ SLA tracking (temps de rÃ©ponse)
âŒ Tests unitaires
```

#### IncidentController
```java
âŒ GET /api/v1/moderation/incidents
âŒ GET /api/v1/moderation/incidents/{id}
âŒ PUT /api/v1/moderation/incidents/{id}/review
âŒ POST /api/v1/moderation/incidents/{id}/escalate
âŒ GET /api/v1/moderation/incidents/stats
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/service/incident/
â”œâ”€â”€ IncidentManagementService.java
â”œâ”€â”€ WarningService.java
â””â”€â”€ EscalationService.java

src/main/java/com/nexusai/moderation/controller/
â””â”€â”€ IncidentController.java

src/main/java/com/nexusai/moderation/repository/
â”œâ”€â”€ UserWarningRepository.java (existe, Ã  complÃ©ter)
â””â”€â”€ UserBanRepository.java (Ã  crÃ©er)

src/test/java/com/nexusai/moderation/service/incident/
â”œâ”€â”€ IncidentManagementServiceTest.java
â”œâ”€â”€ WarningServiceTest.java
â””â”€â”€ EscalationServiceTest.java
```

---

### 4. Consent & Compliance (DÃ©veloppeur 5) - 1.5 semaines

#### ConsentManagementService
```java
âŒ MÃ©thode createConsent(userId, consentType, ipAddress)
âŒ MÃ©thode revokeConsent(consentId)
âŒ MÃ©thode hasActiveConsent(userId, type)
âŒ MÃ©thode getActiveConsents(userId)
âŒ VÃ©rification expiration (90 jours)
âŒ Tests unitaires
```

#### DigitalSignatureService
```java
âŒ MÃ©thode generateSignature(consentData, privateKey)
âŒ MÃ©thode verifySignature(signature, publicKey)
âŒ MÃ©thode hashConsentData(consent)
âŒ Support RSA-2048
âŒ Tests unitaires
```

#### ConsentController
```java
âŒ POST /api/v1/moderation/consents (crÃ©er consentement)
âŒ GET /api/v1/moderation/consents/active
âŒ DELETE /api/v1/moderation/consents/{id} (rÃ©voquer)
âŒ GET /api/v1/moderation/consents/{id}/verify
```

#### KYC Integration
```java
âŒ IntÃ©gration avec User Service pour vÃ©rification KYC
âŒ VÃ©rification niveau KYC 3 requis pour VIP+
âŒ Cache statut KYC (Redis, TTL 1h)
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/service/consent/
â”œâ”€â”€ ConsentManagementService.java
â”œâ”€â”€ DigitalSignatureService.java
â””â”€â”€ KYCVerificationService.java

src/main/java/com/nexusai/moderation/controller/
â””â”€â”€ ConsentController.java

src/main/java/com/nexusai/moderation/repository/
â””â”€â”€ AdultContentConsentRepository.java (existe, Ã  complÃ©ter)

src/test/java/com/nexusai/moderation/service/consent/
â”œâ”€â”€ ConsentManagementServiceTest.java
â””â”€â”€ DigitalSignatureServiceTest.java
```

---

### 5. Notifications (Transversal) - 3 jours

#### NotificationService (implÃ©mentation complÃ¨te)
```java
âŒ ImplÃ©mentation sendSystemMessage() avec WebSocket
âŒ ImplÃ©mentation alertSupportTeam() avec Slack/Email
âŒ MÃ©thode sendEmail(userId, template, data)
âŒ MÃ©thode sendPushNotification(userId, message)
âŒ Templates emails (dÃ©tresse, avertissement, ban)
âŒ Tests unitaires
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/service/notification/
â”œâ”€â”€ NotificationServiceImpl.java
â”œâ”€â”€ EmailService.java
â”œâ”€â”€ WebSocketNotificationService.java
â””â”€â”€ SlackNotificationService.java

src/main/resources/templates/email/
â”œâ”€â”€ distress-resources.html
â”œâ”€â”€ warning-issued.html
â””â”€â”€ account-banned.html
```

---

### 6. Event System (Kafka) - 2 jours

#### ModerationEventPublisher (complÃ©ter)
```java
âŒ publishIncidentCreated(incident)
âŒ publishUserBanned(userId, reason)
âŒ publishUserWarned(userId, warning)
âœ… publishDistressDetected(event) (dÃ©jÃ  fait)
```

#### ModerationEventListener
```java
âŒ onUserDeleted(event) â†’ Supprimer incidents utilisateur
âŒ onSubscriptionChanged(event) â†’ Mettre Ã  jour niveau modÃ©ration
```

**Fichiers Ã  crÃ©er/complÃ©ter :**
```
src/main/java/com/nexusai/moderation/event/
â”œâ”€â”€ ModerationEventPublisher.java (complÃ©ter)
â””â”€â”€ ModerationEventListener.java (crÃ©er)

src/main/java/com/nexusai/moderation/event/events/
â”œâ”€â”€ IncidentCreatedEvent.java
â”œâ”€â”€ UserBannedEvent.java
â””â”€â”€ UserWarnedEvent.java
```

---

### 7. Configuration & Infrastructure - 2 jours

#### SecurityConfig
```java
âŒ Configuration JWT complÃ¨te
âŒ Gestion rÃ´les (USER, MODERATOR, ADMIN)
âŒ Endpoints publics/protÃ©gÃ©s
âŒ CORS configuration
```

#### CacheConfig
```java
âŒ Configuration Redis
âŒ Caches : moderation-rules, user-levels, kyc-status
âŒ TTL par cache
```

#### Swagger/OpenAPI
```java
âŒ Configuration OpenAPI 3
âŒ Documentation complÃ¨te des APIs
âŒ Exemples de requÃªtes/rÃ©ponses
```

**Fichiers Ã  crÃ©er :**
```
src/main/java/com/nexusai/moderation/config/
â”œâ”€â”€ SecurityConfig.java
â”œâ”€â”€ CacheConfig.java
â”œâ”€â”€ OpenApiConfig.java
â””â”€â”€ RestTemplateConfig.java
```

---

### 8. Fichiers de ressources manquants

#### Blacklist
```
âŒ src/main/resources/blacklists/terms.txt
âŒ src/main/resources/blacklists/patterns.txt
```

#### Templates email
```
âŒ src/main/resources/templates/email/distress-resources.html
âŒ src/main/resources/templates/email/warning-issued.html
âŒ src/main/resources/templates/email/account-banned.html
```

#### Fichiers test
```
âŒ src/test/resources/application-test.yml
âŒ src/test/resources/test-data.sql
```

---

### 9. Documentation manquante

```
âŒ docs/api-reference.md (documentation dÃ©taillÃ©e APIs)
âŒ docs/moderation-rules.md (explication rÃ¨gles)
âŒ docs/deployment-guide.md (guide dÃ©ploiement dÃ©taillÃ©)
âŒ docs/troubleshooting.md (rÃ©solution problÃ¨mes)
âŒ CONTRIBUTING.md (guide contribution)
âŒ CHANGELOG.md (historique versions)
```

---

### 10. Monitoring & Observability - 1 semaine

#### MÃ©triques Prometheus
```java
âŒ Counter: moderation_requests_total
âŒ Counter: moderation_blocked_total
âŒ Histogram: moderation_response_time
âŒ Gauge: moderation_queue_size
âŒ Counter: incidents_by_type
```

#### Dashboard Grafana
```
âŒ monitoring/grafana-dashboard.json
âŒ Panels: RequÃªtes, Blocages, Temps rÃ©ponse, Incidents
```

#### Alertes Prometheus
```
âŒ monitoring/prometheus-alerts.yml
âŒ Alertes: HighErrorRate, CriticalIncidentsPending, etc.
```

---

## ğŸ“Š RÃ©capitulatif

| CatÃ©gorie | Ã‰tat | Temps restant |
|-----------|------|---------------|
| Infrastructure & Config | 70% âœ… | 2 jours |
| Text Moderation | 100% âœ… | - |
| Media Moderation | 0% âŒ | 2 semaines |
| Detection Services | 50% âš ï¸ | 1 semaine |
| Incident Management | 10% âŒ | 2 semaines |
| Consent & Compliance | 20% âš ï¸ | 1.5 semaines |
| Notifications | 20% âš ï¸ | 3 jours |
| Events Kafka | 30% âš ï¸ | 2 jours |
| Tests | 40% âš ï¸ | 1 semaine |
| Documentation | 60% âš ï¸ | 3 jours |
| Monitoring | 0% âŒ | 1 semaine |

**TOTAL RESTANT : ~5-6 semaines** avec 6 dÃ©veloppeurs

---

## ğŸ¯ PrioritÃ©s

### P0 (Critique - MVP)
1. âœ… Text Moderation (FAIT)
2. âŒ Incident Management (EN COURS)
3. âŒ Notifications de base
4. âŒ Tests d'intÃ©gration

### P1 (Important - Release 1.0)
1. âŒ Image Moderation
2. âŒ Consent Management
3. âŒ Warning System
4. âŒ Monitoring basique

### P2 (Nice to have - Release 1.1)
1. âŒ Video Moderation
2. âŒ Emotion Analysis
3. âŒ Dashboard Grafana complet
4. âŒ Documentation avancÃ©e

---

## ğŸš€ Plan d'action immÃ©diat (Sprint 1 - 2 semaines)

### Semaine 1
- [ ] Dev 4 : IncidentManagementService + WarningService
- [ ] Dev 5 : ConsentManagementService
- [ ] Dev 6 : SecurityConfig + NotificationService
- [ ] Tous : Tests unitaires

### Semaine 2
- [ ] Dev 2 : ImageModerationService
- [ ] Dev 3 : EmotionAnalysisService
- [ ] Dev 4 : EscalationService + IncidentController
- [ ] Dev 5 : DigitalSignatureService + ConsentController
- [ ] Dev 6 : Kafka Events + Tests intÃ©gration

**Objectif** : MVP fonctionnel en 2 semaines ! ğŸ¯
